<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8>
    <title>Visualizer</title>
    <link rel="stylesheet" type="text/css" href="/static/css/visualizer.css"/>
    <script src="/static/js/three.js"></script>
    <script src="/static/js/OrbitControls.js"></script>
    <script src="/static/js/jquery-3.1.0.min.js"></script>        
    <script src="/static/js/BZVisualizer.js"></script>        
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="stylesheet" href="/static/css/ChemDoodleWeb.css" type="text/css">
    <script type="text/javascript" src="/static/js/ChemDoodleWeb.js"></script>

    <script>
    var jsondata = {{ jsondata|safe }};
    var json_content = {{ json_content|safe }};

    $( document ).ready(function() {
        load_BZ(canvasID='canvas3d',infoID='info',jsondata=jsondata);
    });

    // global variable
    var structureviewer = null;


    var resize_canvases = function () {
        resize_renderer(); // BZ visualizer
        // resize structure viewer
        if (structureviewer) {
            parentcanvas = document.getElementById('structure');
            the_width = parentcanvas.offsetWidth;
            the_height = parentcanvas.offsetHeight;
            structureviewer.resize(the_width, the_height);
        }
    }
    </script>
</head>
<body onresize='resize_canvases()'>
  <div id='maintitle'><h1>K-path finder and visualizer</h1></div>
  <div id='canvas3dtitle'><h3>Brillouin zone</h3></div>
  <div id='structuretitle'><h3>Structure</h3></div>
  <div id='structure'><script>
    parentcanvas = document.getElementById('structure');
    the_width = parentcanvas.offsetWidth;
    the_height = parentcanvas.offsetHeight;

    structureviewer = new ChemDoodle.TransformCanvas3D('structureviewer', 
      the_width, the_height);
    structureviewer.emptyMessage = 'Loading data...';
    structureviewer.specs.set3DRepresentation('Ball and Stick');
    structureviewer.specs.projectionPerspective_3D = false;
    structureviewer.specs.backgroundColor = 'white';
    structureviewer.specs.atoms_displayLabels_3D = true;
    structureviewer.specs.shapes_color = '#111';
    chemstructure = new ChemDoodle.io.JSONInterpreter().contentFrom(json_content);
    new ChemDoodle.informatics.BondDeducer().deduceCovalentBonds(chemstructure['molecules'][0], 1);
    structureviewer.center = function () {}; // Disable ChemDoodle recentering of molecule (not consistent with cell, uses different recenterings...)

    structureviewer.loadContent(chemstructure['molecules'], chemstructure['shapes']);
    structureviewer.specs.projectionFrontCulling_3D = 0.01;
    structureviewer.specs.projectionBackCulling_3D = 10000;
    structureviewer.setupScene();


    //structureviewer.addShape(chemstructure['shapes'][0]);
    //structureviewer.addMolecule(chemstructure['molecules'][0]);
    //structureviewer.center();
  </script></div>

  <div id='canvas3dcontainer'>
      <div id='canvas3d'></div><div id='info'></div>
  </div>
    
  <div id='below'>  
  <div id='groupbelow'>
      <div id='tablekpoints'>
        <h2>Reciprocal space information</h2>

        <h3>Reciprocal cell vectors (1/&#8491;)</h3>
        <table class="center">
          <thead>
            <th style="padding-right: 15px; text-align: center">b</th>
            <th style="text-align: center">x</th>
            <th style="text-align: center">y</th>
            <th style="text-align: center">z</th>
          </thead>
          <tbody>      
            {% for b in reciprocal_primitive_vectors %}
            <tr>
              <td style="padding-right: 15px; text-align: center">b<sub>{{ b[0] }}</sub></td>
              <td style="text-align: right"><code>{{ "%.10f" % b[1]|float }}</code></td>
              <td style="text-align: right"><code>{{ "%.10f" % b[2]|float }}</code></td>
              <td style="text-align: right"><code>{{ "%.10f" % b[3]|float }}</code></td>
            </tr>
            {% endfor %}
          </tbody>
        </table> 

        <h3>High-symmetry points (scaled units)</h3>
        <table class="center">
          <thead>
            <th style="text-align: center">Label</th>
            <th style="text-align: center">k<sub>1</sub></th>
            <th style="text-align: center">k<sub>2</sub></th>
            <th style="text-align: center">k<sub>3</sub></th>
          </thead>

          <tbody>      

            {% for k in kpoints %}
            <tr>
              <td style="text-align: center"><script>document.write(prettify_label("{{ k[0] }}"));</script></td>
              <td style="text-align: right"><code>{{ "%.10f" % k[1]|float }}</code></td>
              <td style="text-align: right"><code>{{ "%.10f" % k[2]|float }}</code></td>
              <td style="text-align: right"><code>{{ "%.10f" % k[3]|float }}</code></td>
            </tr>
            {% endfor %}


          </tbody>
        </table> 

        <h3>Suggested path</h3>
        <p>
        {% for lab in suggested_path %}<script>document.write(prettify_label("{{ lab }}"));</script>{% endfor %}
        </p>


      </div>
      <div id='structureinfo'>
        <h2>Primitive structure information</h2>

        <h3>Real cell vectors (&#8491;)</h3>
        <table class="center">
          <thead>
            <th style="padding-right: 15px; text-align: center">v</th>
            <th style="text-align: center">x</th>
            <th style="text-align: center">y</th>
            <th style="text-align: center">z</th>
          </thead>
          <tbody>      
            {% for v in direct_vectors %}
            <tr>
              <td style="padding-right: 15px; text-align: center">v<sub>{{ v[0] }}</sub></td>
              <td style="text-align: right"><code>{{ "%.10f" % v[1]|float }}</code></td>
              <td style="text-align: right"><code>{{ "%.10f" % v[2]|float }}</code></td>
              <td style="text-align: right"><code>{{ "%.10f" % v[3]|float }}</code></td>
            </tr>
            {% endfor %}
          </tbody>
        </table> 
 
        <h3>Atom coordinates (scaled)</h3>
        <table class="center">
          <thead>
            <th style="padding-right: 15px; text-align: center">Element</th>
            <th style="text-align: center">r<sub>1</sub></th>
            <th style="text-align: center">r<sub>2</sub></th>
            <th style="text-align: center">r<sub>3</sub></th>
          </thead>
          <tbody>      
            {% for b in atoms_scaled %}
            <tr>
              <td style="padding-right: 15px; text-align: center">{{ b[0] }}</td>
              <td style="text-align: right"><code>{{ "%.10f" % b[1]|float }}</code></td>
              <td style="text-align: right"><code>{{ "%.10f" % b[2]|float }}</code></td>
              <td style="text-align: right"><code>{{ "%.10f" % b[3]|float }}</code></td>
            </tr>
            {% endfor %}
          </tbody>
        </table> 

        <h3>Atom coordinates (Cartesian, &#8491;)</h3>
        <table class="center">
          <thead>
            <th style="padding-right: 15px; text-align: center">Element</th>
            <th style="text-align: center">r<sub>1</sub></th>
            <th style="text-align: center">r<sub>2</sub></th>
            <th style="text-align: center">r<sub>3</sub></th>
          </thead>
          <tbody>      
            {% for b in atoms_cartesian %}
            <tr>
              <td style="padding-right: 15px; text-align: center">{{ b[0] }}</td>
              <td style="text-align: right"><code>{{ "%.10f" % b[1]|float }}</code></td>
              <td style="text-align: right"><code>{{ "%.10f" % b[2]|float }}</code></td>
              <td style="text-align: right"><code>{{ "%.10f" % b[3]|float }}</code></td>
            </tr>
            {% endfor %}
          </tbody>
        </table> 

      </div>

    </div>

    <div id='citations'>
        <h2>How to cite</h2>
        <p>If you use this tool, please cite the following work:
        <ul>
        <li><span style="font-style: italic">For the derivation of the paths:</span> Y. Hinuma, Y Kumagai, F. Oba, I. Tanaka, Band structure diagram 
    paths based on crystallography, arXiv:1602.06402 (2016).
        </li>
        <li><span style="font-style: italic">For the implementation in this tool:</span> G. Pizzi et al., Comp. Mat. Sci. 111, 218 (2016).
        </li>
        </ul>
        </p>
    </div>


    <div id='rawcode'>
        <h2>Raw data (JSON)</h2>
        <p><code>{{ raw_code|safe }}</code></p>
    </div>


    </div>
    

</body>
</html>

